<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
* test_performance.html
* 
* Test services performances.
*
* This page will test service response time using xhr-http requests, taking
* time reference immediately before request starts and immediately after.
* However it will also transform returned data to json, so response time will
* be altered by javascript processing time.
*
* That's the reason why reported times are more like test checks that real
* tests indexes. For more accurate data you can use firebug on Firefox or
* developer tools in webkit-based browsers.
* 
* @package	Comodojo Spare Parts
* @author	comodojo.org
* @copyright	2012 comodojo.org (info@comodojo.org)
* @version	*_BUILD_VERSION_*
* 
* LICENSE:
* 
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as
* published by the Free Software Foundation, either version 3 of the
* License, or (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*
-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Comodojo simpleDataRestDispatcher router performance test</title>
	<link rel="stylesheet" type="text/css" href="test.css" />
	
	<script type="text/javascript" src="../others/dojo.js"></script>
	
	<script type="text/javascript">
	
	require(["dojo/_base/xhr","dojo/dom","dojo/ready"], function(xhr,dom,ready){
	function goTest(test_pattern,test_query_string,test_box) {
		var url = "../?service="+test_pattern+test_query_string;
		var n = new Date();
		xhr.get({
			url: url,
			handleAs:"json",
			sync: true,
			//failOk: true,
			load: function(data){
				var t = new Date();
				document.getElementById(test_box).className = data.success ? "note" : 'important';
				document.getElementById(test_box).innerHTML = (t.getTime()-n.getTime()) + " ms";
			},
			error: function(error) {
				var t = new Date();
				//console.log(error);
				document.getElementById(test_box).className = "warning";
				document.getElementById(test_box).innerHTML = (t.getTime()-n.getTime()) + " ms";
			}
		});
	}		
	
	ready(function() {
		
		setTimeout(function() {
			
			document.getElementById("messages").innerHTML = "Tests running...";
			
			goTest('example_service','&hello_to=test','example_service_routed_box');
			goTest('example_service_alias','&hello_to=test','example_service_cloaked_box');
			goTest('example_service_alias_cached','&hello_to=test','example_service_cached_first_box');
			goTest('example_service_alias_cached','&hello_to=test','example_service_cached_second_box');
			
			goTest('example_database_based_service','','example_database_based_service_routed_box');
			goTest('example_database_based_service_alias','','example_database_based_service_cloaked_box');
			goTest('example_database_based_service_alias_cached','','example_database_based_service_cached_first_box');
			goTest('example_database_based_service_alias_cached','','example_database_based_service_cached_second_box');
			
			document.getElementById("messages").className = "note";
			document.getElementById("messages").innerHTML = "Tests completed!";
			
		}, 2000);
		
	});
	});
		
	</script>
</head>

<body>

	<div id="testContainer">
	
		<div id="testHeader">
	
			<img src="../others/logo.png" alt="The Comodojo Logo"/>
	
		</div>
	
		<div id="testContent">
			<div id="messages" class="important">Please wait, tests will start in few seconds...</div>
			<h1>Example service (helloworld), no db</h1>
				<h2>Direct, routed</h2>
				<div id="example_service_routed_box">...</div>
				<h2>Alias, cloacked</h2>
				<div id="example_service_cloaked_box">...</div>
				<h2>Alias, cloaked & cached (first request)</h2>
				<div id="example_service_cached_first_box">...</div>
				<h2>Alias, cloaked & cached (second request)</h2>
				<div id="example_service_cached_second_box">...</div>
			<h1>Example database-based service</h1>
				<h2>Direct, routed</h2>
				<div id="example_database_based_service_routed_box">...</div>
				<h2>Alias, cloacked</h2>
				<div id="example_database_based_service_cloaked_box">...</div>
				<h2>Alias, cloaked & cached (first request)</h2>
				<div id="example_database_based_service_cached_first_box">...</div>
				<h2>Alias, cloaked & cached (second request)</h2>
				<div id="example_database_based_service_cached_second_box">...</div>
		</div>
		
		<div id="testFooter">
		
			<p>Â© 2011 comodojo.org | <a href="http://www.comodojo.org" target="_blank">comodojo.org</a> | All Rights Reserved | Distributed under <a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">GPL V3</a> terms</p>
		
		</div>
	
	</div>

</div>
</body>
</html>