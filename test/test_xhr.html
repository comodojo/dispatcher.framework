<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
/*
 * test_xhr.html
 * 
 * Test services performances.
 *
 * This page will test service response time using xhr-http requests, taking
 * time reference immediately before request starts and immediately after.
 * However it will also transform returned data to json, so response time will
 * be altered by javascript processing time.
 *
 * That's the reason why reported times are more like test checks that real
 * tests indexes. For more accurate data you can use firebug on Firefox or
 * developer tools in webkit-based browsers.
 * 
 * @package	Comodojo Spare Parts
 * @author	comodojo.org
 * @copyright	2011-2013 comodojo.org (info@comodojo.org)
 * @version	__CURRENT_VERSION__
 * 
 * LICENSE:
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 *
 */
-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Comodojo simpleDataRestDispatcher router performance test</title>
	<link rel="stylesheet" type="text/css" href="test.css" />
	
	<script type="text/javascript" src="../others/dojo.js"></script>
	
	<script type="text/javascript">
	
	require(["dojo/request/xhr","dojo/dom","dojo/ready"], function(xhr,dom,ready){
		
		function goTest(test_method, test_url, test_query, test_box) {
			var url = test_url;
			var n = new Date();
			var xhr_content = {
				handleAs: "json",
				sync: true,
				method: test_method
			};
			if (test_method == 'GET') {
				xhr_content.query = test_query;
			}
			else {
				xhr_content.data = test_query;
			}
			xhr(url, xhr_content).then(function(data){
				var t = new Date();
				document.getElementById(test_box).className = data.success ? "note" : 'important';
				document.getElementById(test_box).innerHTML = '<p>Test '+(data.success ? '' : 'NOT ')+'succeeded</p><pre>'+data.result+'</pre><p>Time elapsed: '+(t.getTime()-n.getTime()) + " ms</p>";
			}, function(err){
				var t = new Date();
				document.getElementById(test_box).className = "warning";
				document.getElementById(test_box).innerHTML = (t.getTime()-n.getTime()) + " ms";
			})/*.always(function(data){console.log(data);})*/;
		};
			
		ready(function() {
			
			setTimeout(function() {
				
				document.getElementById("messages").innerHTML = "Tests running...";
				
				goTest('GET',"../services/example_hello_world.php",{/*service:'example_hello_world',*/to:'test'},'service_get_box');
				goTest('POST',"../services/example_hello_world.php",{/*service:'example_hello_world',*/to:'test'},'service_post_box');
				goTest('PUT',"../services/example_hello_world.php",{/*service:'example_hello_world',*/to:'test'},'service_put_box');
				goTest('DELETE',"../services/example_hello_world.php",{/*service:'example_hello_world',*/to:'test'},'service_delete_box');
				
				goTest('GET',"../index.php",{service:'example_hello_world_alias',to:'test'},'cloaked_get_box');
				goTest('POST',"../index.php",{service:'example_hello_world_alias',to:'test'},'cloaked_post_box');
				goTest('PUT',"../index.php",{service:'example_hello_world_alias',to:'test'},'cloaked_put_box');
				goTest('DELETE',"../index.php",{service:'example_hello_world_alias',to:'test'},'cloaked_delete_box');
				
				goTest('GET',"../index.php",{service:'example_hello_world_alias_307',to:'test'},'routed_get_box');
				goTest('POST',"../index.php",{service:'example_hello_world_alias_307',to:'test'},'routed_post_box');
				goTest('PUT',"../index.php",{service:'example_hello_world_alias_307',to:'test'},'routed_put_box');
				goTest('DELETE',"../index.php",{service:'example_hello_world_alias_307',to:'test'},'routed_delete_box');
				
				document.getElementById("messages").className = "note";
				document.getElementById("messages").innerHTML = "Tests completed!";
				
			}, 2000);
			
		});
	});
		
	</script>
</head>

<body>

	<div id="testContainer">
	
		<div id="testHeader">
	
			<img src="../others/logo.png" alt="The Comodojo Logo"/>
	
		</div>
	
		<div id="testContent">
			<div id="messages" class="important">Please wait, tests will start in few seconds...</div>
			<h1>XHR - TESTING DIFFERENT METHODS</h1>
				<h2>HTTP GET</h2>
				<div id="service_get_box">...</div>
				<h2>HTTP POST</h2>
				<div id="service_post_box">...</div>
				<h2>HTTP PUT</h2>
				<div id="service_put_box">...</div>
				<h2>HTTP DELETE</h2>
				<div id="service_delete_box">...</div>
			<h1>XHR - DIFFERENT METHODS IN CLOAKED REQUESTS</h1>
				<h2>HTTP GET</h2>
				<div id="cloaked_get_box">...</div>
				<h2>HTTP POST</h2>
				<div id="cloaked_post_box">...</div>
				<h2>HTTP PUT</h2>
				<div id="cloaked_put_box">...</div>
				<h2>HTTP DELETE</h2>
				<div id="cloaked_delete_box">...</div>
			<h1>XHR - DIFFERENT METHODS IN ROUTED REQUESTS <span style="color:red;font-weight:bold;">*</span></h1>
				<h2>HTTP GET</h2>
				<div id="routed_get_box">...</div>
				<h2>HTTP POST</h2>
				<div id="routed_post_box">...</div>
				<h2>HTTP PUT</h2>
				<div id="routed_put_box">...</div>
				<h2>HTTP DELETE</h2>
				<div id="routed_delete_box">...</div>
		</div>
		<div class="info">
			<span style="color:red;font-weight:bold;">*</span>&nbsp;&nbsp;Routed XHR uses ad-hoc alias that replies to requests
			with a <em>307</em> redirect status (<em>Temporary Redirect</em>) in order to discourage browser to transform all HTTP
			methods in GET (PRG pattern).
		</div>
		
		<div id="testFooter">
		
			<p>&copy; 2011-2013 comodojo.org | <a href="http://www.comodojo.org" target="_blank">comodojo.org</a> | All Rights Reserved | Distributed under <a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">GPL V3</a> terms</p>
		
		</div>
	
	</div>

</div>
</body>
</html>