<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
* test_router.html
* 
* Test URL router with example services included in package.
* 
* @package	Comodojo Spare Parts
* @author	comodojo.org
* @copyright	2012 comodojo.org (info@comodojo.org)
* @version	*_BUILD_VERSION_*
* 
* LICENSE:
* 
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as
* published by the Free Software Foundation, either version 3 of the
* License, or (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Affero General Public License for more details.
*
* You should have received a copy of the GNU Affero General Public License
* along with this program. If not, see <http://www.gnu.org/licenses/>.
*
-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Comodojo simpleDataRestDispatcher test scripts</title>
	<link rel="stylesheet" type="text/css" href="test.css" />
	
	<script type="text/javascript" src="../others/dojo.js"></script>
	
	<script type="text/javascript">
	require(["dojo/_base/xhr","dojo/dom","dojo/ready","dojo/dom-construct"], function(xhr,dom,ready,domConstruct){
		
		function xhr_req(method, service, content) {
			
			var uid = Math.floor(Math.random()*1001);
			
			dom.byId('testContent').appendChild(domConstruct.create('div',{id: service+'_'+method+'_box_'+uid}));
			
			xhr(method,{
				url:"../index.php",
				handleAs:"json",
				failOk: true,
				load: function(data,ioargs){
					document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = data.result + ' - HTTP status: ' + ioargs.xhr.status,
					document.getElementById(service+'_'+method+'_box_'+uid).className = data.success ? "note" : 'important';
				},
				error: function(error,ioargs) {
					document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = error + ' - HTTP status: ' + ioargs.xhr.status,
					document.getElementById(service+'_'+method+'_box_'+uid).className = "warning";
				},
				content: content
			});
		}
		
		function xhr_req_db(method, service, content) {
			
			var uid = Math.floor(Math.random()*1001);
			
			dom.byId('testContent').appendChild(domConstruct.create('div',{id: service+'_'+method+'_box_'+uid}));
			
			xhr(method,{
				url:"../services/"+service+'.php',
				handleAs:"json",
				failOk: true,
				sync: true, //<= that's to handle in a simple way returned ids
				load: function(data,ioargs){
					switch (method) {
						case 'GET':
							if (data.success) {
								document.getElementById(service+'_'+method+'_box_'+uid).className = "note";
								for (var i in data.result) {
									document.getElementById(service+'_'+method+'_box_'+uid).innerHTML += "ID="+data.result[i].id+
									" TIMESTAMP="+data.result[i].timestamp+
									" TOP="+data.result[i].top+
									" MIDDLE="+data.result[i].middle+
									" BOTTOM="+data.result[i].bottom+"<br />";
								}
							}
							else {
								document.getElementById(service+'_'+method+'_box_'+uid).className = "important";
								document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = data.result + ' - HTTP status: ' + ioargs.xhr.status;
							}
						break;
						case 'PUT':
						case 'POST':
							document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = data.result + ' - HTTP status: ' + ioargs.xhr.status;
							document.getElementById(service+'_'+method+'_box_'+uid).className = data.success ? "note" : 'important';
						break;
						case 'DELETE':
							document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = 'HTTP status: ' + ioargs.xhr.status;
							document.getElementById(service+'_'+method+'_box_'+uid).className = "note";
						break;
					}
				},
				error: function(error,ioargs) {
					document.getElementById(service+'_'+method+'_box_'+uid).innerHTML = error + ' - HTTP status: ' + ioargs.xhr.status;
					document.getElementById(service+'_'+method+'_box_'+uid).className = "warning";
				},
				content: content
			});
		}
		
		ready(function() {
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET,PUT,POST,DELETE) - ROUTED (browser may handle request as GET, see router-config.php for more info)'}));
			xhr_req('GET','example_hello_world',{service:'example_hello_world'});
			xhr_req('PUT','example_hello_world',{service:'example_hello_world'});
			xhr_req('POST','example_hello_world',{service:'example_hello_world'});
			xhr_req('DELETE','example_hello_world',{service:'example_hello_world'});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET,PUT,POST,DELETE) - CLOAKED'}));
			xhr_req('GET','example_hello_world_alias',{service:'example_hello_world_alias'});
			xhr_req('PUT','example_hello_world_alias',{service:'example_hello_world_alias'});
			xhr_req('POST','example_hello_world_alias',{service:'example_hello_world_alias'});
			xhr_req('DELETE','example_hello_world_alias',{service:'example_hello_world_alias'});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET,PUT,POST,DELETE) - CLOAKED and CACHED (Client and Server)'}));
			xhr_req('GET','example_hello_world_alias_cached',{service:'example_hello_world_alias_cached'});
			xhr_req('PUT','example_hello_world_alias_cached',{service:'example_hello_world_alias_cached'});
			xhr_req('POST','example_hello_world_alias_cached',{service:'example_hello_world_alias_cached'});
			xhr_req('DELETE','example_hello_world_alias_cached',{service:'example_hello_world_alias_cached'});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET) - Redirected with 301'}));
			xhr_req('GET','example_hello_world_alias_301',{service:'example_hello_world_alias_301'});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET) - Invalid origin'}));
			xhr_req('GET','example_hello_world_alias_origin',{service:'example_hello_world_alias_origin'});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example hello world (GET) - Invalid origin'}));
			xhr_req('GET','example_hello_world_alias_forcepost',{service:'example_hello_world_alias_forcepost', to:"POST"});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example internal service AUTO-ROUTED (GET) - 400/200/200/404'}));
			xhr_req('GET','example_internal_service',{service:'example_internal_service'});
			xhr_req('GET','example_internal_service',{service:'example_internal_service', text:1});
			xhr_req('GET','example_internal_service',{service:'example_internal_service', text:2});
			xhr_req('GET','example_internal_service',{service:'example_internal_service', text:3});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example external service (GET/PUT/POST:200;DELETE:501'}));
			xhr_req('GET','example_external_service',{service:'example_external_service', p:2});
			xhr_req('PUT','example_external_service',{service:'example_external_service', p:2});
			xhr_req('POST','example_external_service',{service:'example_external_service', p:2});
			xhr_req('DELETE','example_external_service',{service:'example_external_service', p:2});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example external service, alias, server-cached (2xGET:200 - second from cache)'}));
			xhr_req('GET','example_external_service_cached_srv',{service:'example_external_service_cached_srv', p:2});
			xhr_req('GET','example_external_service_cached_srv',{service:'example_external_service_cached_srv', p:2});
			
			dom.byId('testContent').appendChild(domConstruct.create('h2',{innerHTML: 'Example external service, alias, client-cached (2xGET:200)'}));
			xhr_req('GET','example_external_service_cached_cli',{service:'example_external_service_cached_cli', p:2});
			xhr_req('GET','example_external_service_cached_cli',{service:'example_external_service_cached_cli', p:2});
			
		});
		
	});
	
	</script>
</head>

<body>

	<div id="testContainer">
	
		<div id="testHeader">
	
			<img src="../others/logo.png" alt="The Comodojo Logo"/>
	
		</div>
	
		<div id="testContent">
			<h1>This page will tests url router with different example services.</h1>
			<h1>PLEASE NOTE: some tests will return a error, but (in most of cases) it's the desired return value.</h1>
		</div>
		
		<div id="testFooter">
		
			<p>Â© 2012 comodojo.org | <a href="http://www.comodojo.org" target="_blank">comodojo.org</a> | All Rights Reserved | Distributed under <a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">GPL V3</a> terms</p>
		
		</div>
	
	</div>

</div>
</body>
</html>